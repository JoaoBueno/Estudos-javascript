<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <title></title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>

<body>
  <form action="">
    Código:<br>
    <input type="text" id="codigo" name="codigo" value="">
    <br> Descrição:
    <br>
    <input type="text" id="descricao" name="descricao" value="">
    <br><br>
    <input type="submit">
  </form>
   <div class="product-infos">

  </div>
  <div class="result">
  
  </div>


  <script>
    $(document).ready(() => {

      // $.get("http://localhost:3000/api/produtos/595a690c806de287d6fac2d1", function (data) {
      //   console.log('Data:', data)
      //   $(".result").html(data);
      //   $("#codigo").val(data.codigo);
      //   $("#descricao").val(data.descricao);
      //   // alert("Load was performed.");
      // });

      $(document).on('click', 'button.btn-remove', (e) => {
        e.preventDefault()
        const id = $(e.target).data('id')
        console.log('id', id)
        $.ajax({
          type: "DELETE",
          url: "http://localhost:3000/api/produtos/" + id,
        }, 'json').done(function (data) {
          console.log(data);
          if (data.resposta === "Produto excluido com sucesso") {
            $(e.target).closest('tr').fadeOut()
            // $(e.target).closest('tr').remove()
          }
        });
      })

      $(document).on('click', 'button.btn-view', (e) => {
        e.preventDefault()
        const id = $(e.target).data('id')
        console.log('id', id)

        $.get("http://localhost:3000/api/produtos/" + id, function (data) {
          console.log('get data', data)

          const resposta = `<p>${data._id} <br>
            ${data.codigo} <br>
            ${data.descricao} <br>
          </p>`
          $(".product-infos").html(resposta);

        })
      })

      $.get("http://localhost:3000/api/produtos", function (data) {
        console.log('Data:', data)
        const resposta = data.map((e, i) => {
          const tag = `<tr>
          <td>${e.codigo}</td>
          <td>${e.descricao}</td>
          <td><button data-id='${e._id}' class='btn-view'>Visualizar</button></td>
          <td><button data-id='${e._id}' class='btn-remove'>Remover</button></td>
          </tr>`
          return tag
        })

        const table = `<table>${resposta}</table>`
        $(".result").html(resposta);

      });
    });

    $("form").submit(function (event) {

      event.preventDefault();

      const data = {
        "codigo": $('#codigo').val(),
        "descricao": $("#descricao").val()
      }
      console.log('data:', data)

      $.ajax({
        type: "POST",
        url: "http://localhost:3000/api/produtos",
        data
      }, 'json').done(function (data) {
        console.log(data);
      });

    })
  </script>
</body>

</html>